<!DOCTYPE html>

<html :class="{ 'dark' : darkMode === true }" data-content_root="../" lang="en" x-data="{ darkMode: $persist(window.matchMedia('(prefers-color-scheme: dark)').matches), activeSection: ''}">
<head>
<script>
    (function () {
      // Set initial color scheme
      if ((localStorage.getItem("_x_darkMode") === "true") || (window.matchMedia("(prefers-color-scheme: dark)").matches)) {
        document.documentElement.classList.add("dark");
      }

      // Watch for media preference changes
      window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change", (event) => {
        localStorage.setItem("_x_darkMode", event.matches);
        document.documentElement.classList.toggle("dark", event.matches);
      });
    })();
  </script>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<meta charset="utf-8"/>
<meta content="#ffffff" media="(prefers-color-scheme: light)" name="theme-color"/>
<meta content="#030711" media="(prefers-color-scheme: dark)" name="theme-color"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<title>toad.postprocessing.aggregation | toad  documentation</title>
<meta content="toad.postprocessing.aggregation | toad  documentation" property="og:title"/>
<meta content="toad.postprocessing.aggregation | toad  documentation" name="twitter:title"/>
<link href="../_static/pygments.css?v=8d216cef" rel="stylesheet" type="text/css"/>
<link href="../_static/theme.css?v=73505e79" rel="stylesheet" type="text/css"/>
<link href="../_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" rel="stylesheet" type="text/css"/>
<link href="../_static/custom.css?v=a187b300" rel="stylesheet" type="text/css"/>
<link href="../_static/awesome-myst-nb.css?v=3b66abd6" rel="stylesheet" type="text/css"/>
<link href="../_static/favicon.png" rel="icon"/>
<link href="../search.html" rel="search" title="Search"/>
<link href="../genindex.html" rel="index" title="Index"/>
<link href="toad.postprocessing.stats.html" rel="next" title="toad.postprocessing.stats"/>
<link href="toad.postprocessing.html" rel="prev" title="toad.postprocessing"/>
</head>
<body :class="{ 'overflow-hidden': showSidebar }" class="min-h-screen font-sans antialiased bg-background text-foreground" x-data="{ showSidebar: false, showScrollTop: false }">
<div @click.self="showSidebar = false" class="fixed inset-0 z-50 overflow-hidden bg-background/80 backdrop-blur-sm md:hidden" x-cloak="" x-show="showSidebar"></div><div class="relative flex flex-col min-h-screen" id="page"><a class="absolute top-0 left-0 z-[100] block bg-background p-4 text-xl transition -translate-x-full opacity-0 focus:translate-x-0 focus:opacity-100" href="#content">
      Skip to content
    </a><header class="sticky top-0 z-40 w-full border-b shadow-xs border-border bg-background/90 backdrop-blur"><div class="container flex items-center h-14">
<div class="hidden mr-4 md:flex">
<a class="flex items-center mr-6" href="../sidebar_main_nav_links.html">
<img alt="Logo" class="mr-2 dark:invert" height="24" src="../_static/toad.png" width="24"/><span class="hidden font-bold sm:inline-block text-clip whitespace-nowrap">toad  documentation</span>
</a></div><button @click="showSidebar = true" class="inline-flex items-center justify-center h-10 px-0 py-2 mr-2 text-base font-medium transition-colors rounded-md hover:text-accent-foreground hover:bg-transparent md:hidden" type="button">
<svg aria-hidden="true" fill="currentColor" height="24" viewbox="0 96 960 960" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M152.587 825.087q-19.152 0-32.326-13.174t-13.174-32.326q0-19.152 13.174-32.326t32.326-13.174h440q19.152 0 32.326 13.174t13.174 32.326q0 19.152-13.174 32.326t-32.326 13.174h-440Zm0-203.587q-19.152 0-32.326-13.174T107.087 576q0-19.152 13.174-32.326t32.326-13.174h320q19.152 0 32.326 13.174T518.087 576q0 19.152-13.174 32.326T472.587 621.5h-320Zm0-203.587q-19.152 0-32.326-13.174t-13.174-32.326q0-19.152 13.174-32.326t32.326-13.174h440q19.152 0 32.326 13.174t13.174 32.326q0 19.152-13.174 32.326t-32.326 13.174h-440ZM708.913 576l112.174 112.174q12.674 12.674 12.674 31.826t-12.674 31.826Q808.413 764.5 789.261 764.5t-31.826-12.674l-144-144Q600 594.391 600 576t13.435-31.826l144-144q12.674-12.674 31.826-12.674t31.826 12.674q12.674 12.674 12.674 31.826t-12.674 31.826L708.913 576Z"></path>
</svg>
<span class="sr-only">Toggle navigation menu</span>
</button>
<div class="flex items-center justify-between flex-1 gap-2 sm:gap-4 md:justify-end">
<div class="flex-1 w-full md:w-auto md:flex-none"><form @keydown.k.window.meta="$refs.search.focus()" action="../search.html" class="relative flex items-center group" id="searchbox" method="get">
<input aria-label="Search the docs" class="inline-flex items-center font-medium transition-colors bg-transparent focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 ring-offset-background border border-input hover:bg-accent focus:bg-accent hover:text-accent-foreground focus:text-accent-foreground hover:placeholder-accent-foreground py-2 px-4 relative h-9 w-full justify-start rounded-[0.5rem] text-sm text-muted-foreground sm:pr-12 md:w-40 lg:w-64" id="search-input" name="q" placeholder="Search ..." type="search" x-ref="search"/>
<kbd class="pointer-events-none absolute right-1.5 top-2 hidden h-5 select-none text-muted-foreground items-center gap-1 rounded border border-border bg-muted px-1.5 font-mono text-[10px] font-medium opacity-100 sm:flex group-hover:bg-accent group-hover:text-accent-foreground">
<span class="text-xs">⌘</span>
    K
  </kbd>
</form>
</div>
<nav class="flex items-center gap-1">
<a href="https://github.com/tipmip-methods/toad" rel="noopener nofollow" title="Visit GitHub">
<div class="inline-flex items-center justify-center px-0 text-sm font-medium transition-colors rounded-md hover:bg-accent hover:text-accent-foreground h-9 w-9">
<svg fill="currentColor" height="16" viewbox="0 0 16 16" width="16" xmlns="http://www.w3.org/2000/svg">
<path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z"></path>
</svg>
</div>
</a>
<button @click="darkMode = !darkMode" class="relative inline-flex items-center justify-center px-0 text-sm font-medium transition-colors rounded-md hover:bg-accent hover:text-accent-foreground h-9 w-9" title="Toggle color scheme" type="button">
<svg class="absolute transition-all scale-100 rotate-0 dark:-rotate-90 dark:scale-0" fill="currentColor" height="16" viewbox="0 96 960 960" width="16" xmlns="http://www.w3.org/2000/svg">
<path d="M480 685q45.456 0 77.228-31.772Q589 621.456 589 576q0-45.456-31.772-77.228Q525.456 467 480 467q-45.456 0-77.228 31.772Q371 530.544 371 576q0 45.456 31.772 77.228Q434.544 685 480 685Zm0 91q-83 0-141.5-58.5T280 576q0-83 58.5-141.5T480 376q83 0 141.5 58.5T680 576q0 83-58.5 141.5T480 776ZM80 621.5q-19.152 0-32.326-13.174T34.5 576q0-19.152 13.174-32.326T80 530.5h80q19.152 0 32.326 13.174T205.5 576q0 19.152-13.174 32.326T160 621.5H80Zm720 0q-19.152 0-32.326-13.174T754.5 576q0-19.152 13.174-32.326T800 530.5h80q19.152 0 32.326 13.174T925.5 576q0 19.152-13.174 32.326T880 621.5h-80Zm-320-320q-19.152 0-32.326-13.174T434.5 256v-80q0-19.152 13.174-32.326T480 130.5q19.152 0 32.326 13.174T525.5 176v80q0 19.152-13.174 32.326T480 301.5Zm0 720q-19.152 0-32.326-13.17Q434.5 995.152 434.5 976v-80q0-19.152 13.174-32.326T480 850.5q19.152 0 32.326 13.174T525.5 896v80q0 19.152-13.174 32.33-13.174 13.17-32.326 13.17ZM222.174 382.065l-43-42Q165.5 327.391 166 308.239t13.174-33.065q13.435-13.674 32.587-13.674t32.065 13.674l42.239 43q12.674 13.435 12.555 31.706-.12 18.272-12.555 31.946-12.674 13.674-31.445 13.413-18.772-.261-32.446-13.174Zm494 494.761-42.239-43q-12.674-13.435-12.674-32.087t12.674-31.565Q686.609 756.5 705.38 757q18.772.5 32.446 13.174l43 41.761Q794.5 824.609 794 843.761t-13.174 33.065Q767.391 890.5 748.239 890.5t-32.065-13.674Zm-42-494.761Q660.5 369.391 661 350.62q.5-18.772 13.174-32.446l41.761-43Q728.609 261.5 747.761 262t33.065 13.174q13.674 13.435 13.674 32.587t-13.674 32.065l-43 42.239q-13.435 12.674-31.706 12.555-18.272-.12-31.946-12.555Zm-495 494.761Q165.5 863.391 165.5 844.239t13.674-32.065l43-42.239q13.435-12.674 32.087-12.674t31.565 12.674Q299.5 782.609 299 801.38q-.5 18.772-13.174 32.446l-41.761 43Q231.391 890.5 212.239 890t-33.065-13.174ZM480 576Z"></path>
</svg>
<svg class="absolute transition-all scale-0 rotate-90 dark:rotate-0 dark:scale-100" fill="currentColor" height="16" viewbox="0 96 960 960" width="16" xmlns="http://www.w3.org/2000/svg">
<path d="M480 936q-151 0-255.5-104.5T120 576q0-138 90-239.5T440 218q25-3 39 18t-1 44q-17 26-25.5 55t-8.5 61q0 90 63 153t153 63q31 0 61.5-9t54.5-25q21-14 43-1.5t19 39.5q-14 138-117.5 229T480 936Zm0-80q88 0 158-48.5T740 681q-20 5-40 8t-40 3q-123 0-209.5-86.5T364 396q0-20 3-40t8-40q-78 32-126.5 102T200 576q0 116 82 198t198 82Zm-10-270Z"></path>
</svg>
</button>
</nav>
</div>
</div>
</header>
<div class="flex-1"><div class="container md:grid md:grid-cols-[220px_minmax(0,1fr)] md:gap-6 lg:grid-cols-[240px_minmax(0,1fr)] lg:gap-10"><aside :aria-hidden="!showSidebar" :class="{ 'translate-x-0': showSidebar }" class="fixed inset-y-0 left-0 md:top-14 z-50 md:z-30 bg-background md:bg-transparent transition-all duration-100 -translate-x-full md:translate-x-0 ml-0 p-6 md:p-0 md:-ml-2 md:h-[calc(100vh-3.5rem)] w-5/6 md:w-full overflow-y-auto border-r border-border md:sticky" id="left-sidebar">
<a class="justify-start text-sm md:!hidden bg-background" href="../sidebar_main_nav_links.html">
<img alt="Logo" class="mr-2 dark:invert" height="16" src="../_static/toad.png" width="16"/><span class="font-bold text-clip whitespace-nowrap">toad  documentation</span>
</a>
<div class="relative overflow-hidden md:overflow-auto my-4 md:my-0">
<div class="overflow-y-auto h-full w-full relative pr-6"><nav class="table w-full min-w-full my-6 lg:my-8">
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../index.html">Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quick_start.html">Quick Start</a></li>
<li class="toctree-l1" x-data="{ expanded: $el.classList.contains('current') ? true : false }"><a :class="{ 'expanded' : expanded }" @click="expanded = !expanded" class="reference internal expandable" href="../tutorials.html">Tutorials<button @click.prevent.stop="expanded = !expanded" type="button" x-cloak=""><span class="sr-only"></span><svg fill="currentColor" height="18px" stroke="none" viewbox="0 0 24 24" width="18px" xmlns="http://www.w3.org/2000/svg"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path></svg></button></a><ul x-cloak="" x-show="expanded">
<li class="toctree-l2"><a class="reference internal" href="../tutorials/basics.html">TOAD Basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/custom_clustering.html">Implement your own clustering method</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorials/custom_shifts_detection.html">Implement your own shifts detection method</a></li>
</ul>
</li>
<li class="toctree-l1 current" x-data="{ expanded: $el.classList.contains('current') ? true : false }"><a :class="{ 'expanded' : expanded }" @click="expanded = !expanded" class="reference internal expandable" href="../api_ref.html">API Reference<button @click.prevent.stop="expanded = !expanded" type="button" x-cloak=""><span class="sr-only"></span><svg fill="currentColor" height="18px" stroke="none" viewbox="0 0 24 24" width="18px" xmlns="http://www.w3.org/2000/svg"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path></svg></button></a><ul class="current" x-show="expanded">
<li class="toctree-l2"><a class="reference internal" href="toad.TOAD.html">toad.TOAD</a></li>
<li class="toctree-l2"><a class="reference internal" href="toad.shifts.ASDETECT.html">toad.shifts.ASDETECT</a></li>
<li class="toctree-l2"><a class="reference internal" href="toad.plotting.Plotter.html">toad.plotting.Plotter</a></li>
<li class="toctree-l2"><a class="reference internal" href="toad.plotting.MapStyle.html">toad.plotting.MapStyle</a></li>
<li class="toctree-l2"><a class="reference internal" href="toad.regridding.HealPixRegridder.html">toad.regridding.HealPixRegridder</a></li>
<li class="toctree-l2"><a class="reference internal" href="toad.regridding.base.BaseRegridder.html">toad.regridding.base.BaseRegridder</a></li>
<li class="toctree-l2"><a class="reference internal" href="toad.shifts.html">toad.shifts</a></li>
<li class="toctree-l2"><a class="reference internal" href="toad.clustering.html">toad.clustering</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="toad.postprocessing.html">toad.postprocessing</a></li>
<li class="toctree-l2"><a class="reference internal" href="toad.utils.html">toad.utils</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../scientific_ref.html">Scientific References</a></li>
<li class="toctree-l1"><a class="reference internal" href="../release_notes.html">Release Notes</a></li>
</ul>
</nav>
</div>
</div>
<button @click="showSidebar = false" class="absolute md:hidden right-4 top-4 rounded-sm opacity-70 transition-opacity hover:opacity-100" type="button">
<svg class="h-4 w-4" fill="currentColor" height="24" stroke="none" viewbox="0 96 960 960" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M480 632 284 828q-11 11-28 11t-28-11q-11-11-11-28t11-28l196-196-196-196q-11-11-11-28t11-28q11-11 28-11t28 11l196 196 196-196q11-11 28-11t28 11q11 11 11 28t-11 28L536 576l196 196q11 11 11 28t-11 28q-11 11-28 11t-28-11L480 632Z"></path>
</svg>
</button>
</aside>
<main class="relative py-6 lg:gap-10 lg:py-8 xl:grid xl:grid-cols-[1fr_300px]">
<div class="w-full min-w-0 mx-auto">
<nav aria-label="breadcrumbs" class="flex items-center mb-4 space-x-1 text-sm text-muted-foreground">
<a class="overflow-hidden text-ellipsis whitespace-nowrap hover:text-foreground" href="../sidebar_main_nav_links.html">
<span class="hidden md:inline">toad  documentation</span>
<svg aria-label="Home" class="md:hidden" fill="currentColor" height="18" stroke="none" viewbox="0 96 960 960" width="18" xmlns="http://www.w3.org/2000/svg">
<path d="M240 856h120V616h240v240h120V496L480 316 240 496v360Zm-80 80V456l320-240 320 240v480H520V696h-80v240H160Zm320-350Z"></path>
</svg>
</a>
<div class="mr-1">/</div><a class="hover:text-foreground overflow-hidden text-ellipsis whitespace-nowrap" href="../api_ref.html">API Reference</a>
<div class="mr-1">/</div><a class="hover:text-foreground overflow-hidden text-ellipsis whitespace-nowrap" href="toad.postprocessing.html">toad.postprocessing</a>
<div class="mr-1">/</div><span aria-current="page" class="font-medium text-foreground overflow-hidden text-ellipsis whitespace-nowrap">toad.postprocessing.aggregation</span>
</nav>
<div id="content" role="main">
<section id="module-toad.postprocessing.aggregation">
<span id="toad-postprocessing-aggregation"></span><h1>toad.postprocessing.aggregation<a @click.prevent="window.navigator.clipboard.writeText($el.href); $el.setAttribute('data-tooltip', 'Copied!'); setTimeout(() =&gt; $el.setAttribute('data-tooltip', 'Copy link to this element'), 2000)" aria-label="Copy link to this element" class="headerlink" data-tooltip="Copy link to this element" href="#module-toad.postprocessing.aggregation"><span>¶</span></a></h1>
<p class="rubric">Functions</p>
<table class="autosummary longtable docutils align-default">
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="#toad.postprocessing.aggregation.jaccard_similarity" title="toad.postprocessing.aggregation.jaccard_similarity"><code class="xref py py-obj docutils literal notranslate"><span class="pre">jaccard_similarity</span></code></a>(set_a, set_b)</p></td>
<td><p>Compute Jaccard similarity between two sets: <a href="#id2"><span class="problematic" id="id3">|A ∩ B|</span></a> / <a href="#id4"><span class="problematic" id="id5">|A ∪ B|</span></a></p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="#toad.postprocessing.aggregation.precompute_spatial_memberships" title="toad.postprocessing.aggregation.precompute_spatial_memberships"><code class="xref py py-obj docutils literal notranslate"><span class="pre">precompute_spatial_memberships</span></code></a>(td, cluster_vars)</p></td>
<td><p>Precompute flattened membership sets for each (cluster_var, cluster_id) pair.</p></td>
</tr>
</tbody>
</table>
<p class="rubric">Classes</p>
<table class="autosummary longtable docutils align-default">
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="#toad.postprocessing.aggregation.Aggregation" title="toad.postprocessing.aggregation.Aggregation"><code class="xref py py-obj docutils literal notranslate"><span class="pre">Aggregation</span></code></a>(toad)</p></td>
<td><p>Aggregation methods for TOAD objects.</p></td>
</tr>
</tbody>
</table>
<dl class="py class">
<dt class="sig sig-object py" id="toad.postprocessing.aggregation.Aggregation">
<span class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></span><span class="sig-prename descclassname"><span class="pre">toad.postprocessing.aggregation.</span></span><span class="sig-name descname"><span class="pre">Aggregation</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">toad</span></span></em><span class="sig-paren">)</span><a @click.prevent="window.navigator.clipboard.writeText($el.href); $el.setAttribute('data-tooltip', 'Copied!'); setTimeout(() =&gt; $el.setAttribute('data-tooltip', 'Copy link to this element'), 2000)" aria-label="Copy link to this element" class="headerlink" data-tooltip="Copy link to this element" href="#toad.postprocessing.aggregation.Aggregation" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#toad.postprocessing.aggregation.Aggregation'"><span>¶</span></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Aggregation methods for TOAD objects.</p>
<dl class="py method">
<dt class="sig sig-object py" id="toad.postprocessing.aggregation.Aggregation.cluster_consensus">
<span class="sig-name descname"><span class="pre">cluster_consensus</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cluster_vars</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_consensus</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.75</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">top_n_clusters</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">neighbor_connectivity</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">8</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">regridder</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">k_neighbors</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">8</span></span></em><span class="sig-paren">)</span><a @click.prevent="window.navigator.clipboard.writeText($el.href); $el.setAttribute('data-tooltip', 'Copied!'); setTimeout(() =&gt; $el.setAttribute('data-tooltip', 'Copy link to this element'), 2000)" aria-label="Copy link to this element" class="headerlink" data-tooltip="Copy link to this element" href="#toad.postprocessing.aggregation.Aggregation.cluster_consensus" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#toad.postprocessing.aggregation.Aggregation.cluster_consensus'"><span>¶</span></a></dt>
<dd><p>Build a spatial consensus clustering from multiple clustering results.</p>
<p>Implements a consensus aggregation method closely related to evidence accumulation clustering (EAC)
from <a class="reference internal" href="../scientific_ref.html#fred-jain2005" id="id1"><span>[Fred+Jain2005]</span></a>, but reformulated for spatial grid data. Instead of dense all-pairs
co-association, we accumulate “votes” only between spatially neighboring cells, yielding a
scalable sparse adjacency graph from which consensus regions are formed.</p>
<p>The method produces robust, spatially coherent regions that persist across clustering
choices/variables by combining clusterings through a graph-based consensus approach.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>cluster_vars</strong> (<em>List</em><em>[</em><em>str</em><em>] </em><em>| </em><em>None</em>) – List of clustering variable names to include in the consensus.
If None, uses all cluster variables in self.td.cluster_vars.</p></li>
<li><p><strong>min_consensus</strong> (<em>float</em>) – Minimum fraction (in [0,1]) of clusterings that must support an edge
(pixel adjacency) for it to be included in the consensus graph. Higher values =
stricter consensus. Default: 0.5.</p></li>
<li><p><strong>top_n_clusters</strong> (<em>int</em><em> | </em><em>None</em>) – If set, only top N largest clusters (per clustering) are used when
voting for edges. If None, all clusters are included. Default: None.</p></li>
<li><p><strong>neighbor_connectivity</strong> (<em>int</em>) – Neighborhood connectivity for spatial adjacency when lat/lon
coordinates are not available. Either 4 (Von Neumann, horizontal/vertical only)
or 8 (Moore, including diagonals). Default: 8. This parameter controls index-based
grid adjacency (not K-nearest neighbors) and is only used for grids without
geographic coordinates; for lat/lon grids, see <cite>k_neighbors</cite>.</p></li>
<li><p><strong>regridder</strong> (<a class="reference internal" href="toad.regridding.HealPixRegridder.html#toad.regridding.HealPixRegridder" title="toad.regridding.healpix.HealPixRegridder"><em>HealPixRegridder</em></a><em> | </em><em>None</em>) – Optional custom regridder. If None and data has regular lat/lon dimensions,
HealPixRegridder will be used automatically. Default: None.
<strong>Note:</strong> Currently only HealPixRegridder is supported for consensus clustering.
Other regridders will raise a ValueError.</p></li>
<li><p><strong>k_neighbors</strong> (<em>int</em>) – Number of nearest neighbors to consider for lat/lon grids using
K-nearest neighbors on the sphere. Only applies when lat/lon coordinates are
available. Higher values provide more connectivity but may be less spatially
selective. Default: 8. For very high-resolution grids, consider increasing to
12-16; for coarse grids, 4-6 may suffice.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><p>A tuple containing:</p>
<dl class="simple">
<dt>Dataset with two variables:</dt><dd><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">clusters</span></code> (int32, shape (y, x)): Consensus cluster/component labels.
Values &gt;= 0 indicate cluster membership; -1 indicates noise/unassigned.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">consistency</span></code> (float32, shape (y, x)): Local mean of co-association edge
weights around each pixel, reflecting neighborhood agreement across input
cluster maps.</p></li>
</ul>
</dd>
<dt>DataFrame with one row per consensus cluster, containing:</dt><dd><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">cluster_id</span></code> (int32): Cluster identifier.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mean_consistency</span></code> (float32): Mean consistency score for the cluster.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">size</span></code> (int32): Number of spatial grid cells in the cluster.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mean_{space_dim0}</span></code> (float32): Average spatial coordinate for first dimension.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mean_{space_dim1}</span></code> (float32): Average spatial coordinate for second dimension.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mean_mean_shift_time</span></code> (float32): Central estimate of transition time,
averaged over space and clusterings.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">std_mean_shift_time</span></code> (float32): Variation in average shift time across
clusterings.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mean_std_shift_time</span></code> (float32): Average spatial spread of shift timing.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">std_std_shift_time</span></code> (float32): Variation in spatial coherence across
clusterings.</p></li>
</ul>
</dd>
</dl>
</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>Tuple[xr.Dataset, pd.DataFrame]</p>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>The algorithm proceeds as follows:</p>
<ol class="arabic simple">
<li><p>Collapse time in each clustering map: mark a pixel as “clustered” if it is ever
assigned to a cluster at any time.</p></li>
<li><p>For each clustering, obtain the spatial footprint of each cluster. Optionally,
restrict to the top N clusters.</p></li>
<li><p>For each cluster, increment votes for each pair of adjacent (connected) pixels
within that cluster.</p></li>
<li><p>Accumulate edge votes across all clusterings, then normalize by the number of
clustering maps.</p></li>
<li><p>Retain only those edges (pixel adjacencies) present in at least <cite>min_consensus</cite>
fraction of clusterings.</p></li>
<li><p>Construct an undirected sparse graph with surviving edges; run connected components
labeling.</p></li>
<li><p>Relabel clusters in order of descending size for interpretability; assign -1 to
isolated (noise) pixels.</p></li>
<li><p>Compute, for each pixel, the mean strength (consistency) of its incident consensus
edges.</p></li>
</ol>
<p>Additional implementation details:</p>
<ul>
<li><p>Adjacency method depends on grid type:
- For lat/lon grids: K-nearest neighbors on sphere using geodesic distance</p>
<blockquote>
<div><p>(controlled by <cite>k_neighbors</cite>, default 8). This uses coordinate-based spatial
relationships rather than grid indices.</p>
</div></blockquote>
<ul class="simple">
<li><p>For non-geographic grids: Index-based 4- or 8-connectivity using grid array
structure (controlled by <cite>neighbor_connectivity</cite>). This is not K-nearest
neighbors—it connects cells based on their position in the 2D array (horizontal,
vertical, and optionally diagonal neighbors in grid index space).</p></li>
</ul>
</li>
<li><p>Consensus clusters represent regions whose internal edges are repeatedly co-clustered
across the inputs and may be chained via single-link paths.</p></li>
<li><p>Large, non-compact clusters can form if consensus is too lenient; increase
<cite>min_consensus</cite> or apply additional filtering for tighter components if needed.</p></li>
<li><p>Suitable for identifying robust tipping regions or domains unaffected by clustering noise.</p></li>
</ul>
<p class="rubric">Example</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><code><span id="line-1"><span class="gp">&gt;&gt;&gt; </span><span class="n">ds</span><span class="p">,</span> <span class="n">summary_df</span> <span class="o">=</span> <span class="n">td</span><span class="o">.</span><span class="n">aggregate</span><span class="o">.</span><span class="n">cluster_consensus</span><span class="p">(</span>
</span><span id="line-2"><span class="gp">... </span>    <span class="n">cluster_vars</span><span class="o">=</span><span class="p">[</span><span class="s1">'clust_a'</span><span class="p">,</span> <span class="s1">'clust_b'</span><span class="p">],</span> <span class="n">min_consensus</span><span class="o">=</span><span class="mf">0.7</span>
</span><span id="line-3"><span class="gp">... </span><span class="p">)</span>
</span><span id="line-4"><span class="gp">&gt;&gt;&gt; </span><span class="n">ds</span><span class="o">.</span><span class="n">clusters</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>  <span class="c1"># Visualize consensus clusters</span>
</span><span id="line-5"><span class="gp">&gt;&gt;&gt; </span><span class="n">summary_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>  <span class="c1"># View cluster statistics</span>
</span></code></pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ValueError</strong> – If neighbor_connectivity is not 4 or 8.</p></li>
<li><p><strong>AssertionError</strong> – If no cluster_vars are found.</p></li>
</ul>
</dd>
<dt class="field-even">Parameters<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>cluster_vars</strong> (<em>List</em><em>[</em><em>str</em><em>] </em><em>| </em><em>None</em>)</p></li>
<li><p><strong>min_consensus</strong> (<em>float</em>)</p></li>
<li><p><strong>top_n_clusters</strong> (<em>int</em><em> | </em><em>None</em>)</p></li>
<li><p><strong>neighbor_connectivity</strong> (<em>int</em>)</p></li>
<li><p><strong>regridder</strong> (<a class="reference internal" href="toad.regridding.HealPixRegridder.html#toad.regridding.HealPixRegridder" title="toad.regridding.healpix.HealPixRegridder"><em>HealPixRegridder</em></a><em> | </em><em>None</em>)</p></li>
<li><p><strong>k_neighbors</strong> (<em>int</em>)</p></li>
</ul>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><em>Tuple</em>[<em>Dataset</em>, <em>DataFrame</em>]</p>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>Evidence accumulation clustering (EAC) method from Fred &amp; Jain (2005). This
implementation uses spatial adjacency instead of dense all-pairs co-association
for scalability.</p>
</div>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="toad.postprocessing.aggregation.Aggregation.cluster_consistency">
<span class="sig-name descname"><span class="pre">cluster_consistency</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cluster_vars</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a @click.prevent="window.navigator.clipboard.writeText($el.href); $el.setAttribute('data-tooltip', 'Copied!'); setTimeout(() =&gt; $el.setAttribute('data-tooltip', 'Copy link to this element'), 2000)" aria-label="Copy link to this element" class="headerlink" data-tooltip="Copy link to this element" href="#toad.postprocessing.aggregation.Aggregation.cluster_consistency" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#toad.postprocessing.aggregation.Aggregation.cluster_consistency'"><span>¶</span></a></dt>
<dd><p>Evaluate the spatial consistency of cluster membership for each grid cell
across multiple clustering variables (e.g., from different models).</p>
<p><strong>⚠️ Deprecated:</strong> This function is conceptually superseded by <cite>cluster_consensus()</cite>.
The Jaccard-based cluster consistency metric is retained for backwards compatibility
but will be removed in a future release. The <cite>consistency</cite> field returned by
<cite>cluster_consensus()</cite> provides a more efficient and interpretable measure of local
co-association across runs.</p>
<p>This function measures how stable the <em>spatial neighborhood</em> of each grid cell’s
cluster is across clustering variables, using the Jaccard similarity.</p>
<p>For each grid cell:
1. Identify which cluster it belongs to in each clustering variable.
2. For every pair of clusterings, retrieve the full set of grid cells that were
in the same cluster, and compute the Jaccard similarity between these sets.
(Jaccard = <a href="#id6"><span class="problematic" id="id7">|A ∩ B|</span></a> / <a href="#id8"><span class="problematic" id="id9">|A ∪ B|</span></a>)
3. Average the Jaccard scores over all clustering pairs to obtain a consistency score.</p>
<p>Interpretation:
- A score near 1.0 means the cell consistently clusters with the same spatial
neighborhood across different clustering setups.
- A score near 0.0 means the cell’s cluster context varies substantially.
- NaN is returned if the cell is unclustered (noise) in all clustering variables.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>td</strong> – TOAD object containing clustering results.</p></li>
<li><p><strong>cluster_vars</strong> (<em>list</em><em>[</em><em>str</em><em>] </em><em>| </em><em>None</em>) – Optional list of cluster variable names. If None, uses td.cluster_vars.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><dl class="simple">
<dt>Stability scores per grid cell, with the same spatial shape</dt><dd><p>as the input data and values in [0, 1] or NaN.</p>
</dd>
</dl>
</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>xr.DataArray</p>
</dd>
</dl>
</dd></dl>
<dl class="py method">
<dt class="sig sig-object py" id="toad.postprocessing.aggregation.Aggregation.cluster_occurrence_rate">
<span class="sig-name descname"><span class="pre">cluster_occurrence_rate</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cluster_vars</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a @click.prevent="window.navigator.clipboard.writeText($el.href); $el.setAttribute('data-tooltip', 'Copied!'); setTimeout(() =&gt; $el.setAttribute('data-tooltip', 'Copy link to this element'), 2000)" aria-label="Copy link to this element" class="headerlink" data-tooltip="Copy link to this element" href="#toad.postprocessing.aggregation.Aggregation.cluster_occurrence_rate" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#toad.postprocessing.aggregation.Aggregation.cluster_occurrence_rate'"><span>¶</span></a></dt>
<dd><p>Calculate the normalized occurrence rate of points being part of any cluster.</p>
<p>For each point in space, calculates how many times it is part of a cluster
(not noise) across different clustering variables, normalized by the total
number of clusterings. This is done by checking if each point was ever part
of a cluster (cluster label &gt; -1) for each clustering variable, summing these
occurrences, and dividing by the total number of clustering variables.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>cluster_vars</strong> (<em>list</em><em>[</em><em>str</em><em>] </em><em>| </em><em>None</em>) – List of clustering variable names to consider. If None,
uses all clustering variables in the TOAD object. Each variable should
contain cluster labels where -1 indicates noise points and values &gt;= 0
indicate cluster membership.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>DataArray containing the normalized cluster occurrence rate for each point.
Values range from 0 (never in a cluster) to 1 (always in a cluster).
The output variable name will be “cluster_occurence_rate” with a numeric
suffix if that name already exists in the dataset.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p><em>DataArray</em></p>
</dd>
</dl>
<p class="rubric">Example</p>
<p>If a point is part of a cluster in 2 out of 3 clustering variables,
its occurrence rate would be 2/3 ≈ 0.67.</p>
</dd></dl>
</dd></dl>
<dl class="py function">
<dt class="sig sig-object py" id="toad.postprocessing.aggregation.jaccard_similarity">
<span class="sig-prename descclassname"><span class="pre">toad.postprocessing.aggregation.</span></span><span class="sig-name descname"><span class="pre">jaccard_similarity</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">set_a</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">set_b</span></span></em><span class="sig-paren">)</span><a @click.prevent="window.navigator.clipboard.writeText($el.href); $el.setAttribute('data-tooltip', 'Copied!'); setTimeout(() =&gt; $el.setAttribute('data-tooltip', 'Copy link to this element'), 2000)" aria-label="Copy link to this element" class="headerlink" data-tooltip="Copy link to this element" href="#toad.postprocessing.aggregation.jaccard_similarity" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#toad.postprocessing.aggregation.jaccard_similarity'"><span>¶</span></a></dt>
<dd><p>Compute Jaccard similarity between two sets: <a href="#id10"><span class="problematic" id="id11">|A ∩ B|</span></a> / <a href="#id12"><span class="problematic" id="id13">|A ∪ B|</span></a></p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>set_a</strong> – Input sets to compare</p></li>
<li><p><strong>set_b</strong> – Input sets to compare</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><dl class="simple">
<dt>Similarity score in [0,1]. 1.0 means identical sets,</dt><dd><p>0.0 means no overlap. Returns 1.0 if both sets are empty.</p>
</dd>
</dl>
</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>float</p>
</dd>
</dl>
</dd></dl>
<dl class="py function">
<dt class="sig sig-object py" id="toad.postprocessing.aggregation.precompute_spatial_memberships">
<span class="sig-prename descclassname"><span class="pre">toad.postprocessing.aggregation.</span></span><span class="sig-name descname"><span class="pre">precompute_spatial_memberships</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">td</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cluster_vars</span></span></em><span class="sig-paren">)</span><a @click.prevent="window.navigator.clipboard.writeText($el.href); $el.setAttribute('data-tooltip', 'Copied!'); setTimeout(() =&gt; $el.setAttribute('data-tooltip', 'Copy link to this element'), 2000)" aria-label="Copy link to this element" class="headerlink" data-tooltip="Copy link to this element" href="#toad.postprocessing.aggregation.precompute_spatial_memberships" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#toad.postprocessing.aggregation.precompute_spatial_memberships'"><span>¶</span></a></dt>
<dd><p>Precompute flattened membership sets for each (cluster_var, cluster_id) pair.
For each cluster in each clustering, stores which grid cells were ever part of that cluster.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>td</strong> – TOAD instance containing the cluster variables</p></li>
<li><p><strong>cluster_vars</strong> – List of cluster variable names to process</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><dl class="simple">
<dt>Maps (cluster_var, cluster_id) tuples to sets of flattened grid cell indices.</dt><dd><p>Only includes non-noise clusters (cluster_id &gt;= 0).</p>
</dd>
</dl>
</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>dict</p>
</dd>
</dl>
</dd></dl>
</section>
</div><div class="flex justify-between items-center pt-6 mt-12 border-t border-border gap-4">
<div class="mr-auto">
<a class="inline-flex items-center justify-center rounded-md text-sm font-medium transition-colors border border-input hover:bg-accent hover:text-accent-foreground py-2 px-4" href="toad.postprocessing.html">
<svg class="mr-2 h-4 w-4" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
<polyline points="15 18 9 12 15 6"></polyline>
</svg>
        toad.postprocessing
      </a>
</div>
<div class="ml-auto">
<a class="inline-flex items-center justify-center rounded-md text-sm font-medium transition-colors border border-input hover:bg-accent hover:text-accent-foreground py-2 px-4" href="toad.postprocessing.stats.html">
        toad.postprocessing.stats
        <svg class="ml-2 h-4 w-4" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
<polyline points="9 18 15 12 9 6"></polyline>
</svg>
</a>
</div>
</div></div><aside class="hidden text-sm xl:block" id="right-sidebar">
<div class="sticky top-16 -mt-10 max-h-[calc(100vh-5rem)] h-full overflow-y-auto pt-6 space-y-2"><p class="font-medium">On this page</p>
<ul>
<li><a :data-current="activeSection === '#toad.postprocessing.aggregation.Aggregation'" class="reference internal" href="#toad.postprocessing.aggregation.Aggregation"><code class="docutils literal notranslate"><span class="pre">Aggregation</span></code></a><ul>
<li><a :data-current="activeSection === '#toad.postprocessing.aggregation.Aggregation.cluster_consensus'" class="reference internal" href="#toad.postprocessing.aggregation.Aggregation.cluster_consensus"><code class="docutils literal notranslate"><span class="pre">Aggregation.cluster_consensus()</span></code></a></li>
<li><a :data-current="activeSection === '#toad.postprocessing.aggregation.Aggregation.cluster_consistency'" class="reference internal" href="#toad.postprocessing.aggregation.Aggregation.cluster_consistency"><code class="docutils literal notranslate"><span class="pre">Aggregation.cluster_consistency()</span></code></a></li>
<li><a :data-current="activeSection === '#toad.postprocessing.aggregation.Aggregation.cluster_occurrence_rate'" class="reference internal" href="#toad.postprocessing.aggregation.Aggregation.cluster_occurrence_rate"><code class="docutils literal notranslate"><span class="pre">Aggregation.cluster_occurrence_rate()</span></code></a></li>
</ul>
</li>
<li><a :data-current="activeSection === '#toad.postprocessing.aggregation.jaccard_similarity'" class="reference internal" href="#toad.postprocessing.aggregation.jaccard_similarity"><code class="docutils literal notranslate"><span class="pre">jaccard_similarity()</span></code></a></li>
<li><a :data-current="activeSection === '#toad.postprocessing.aggregation.precompute_spatial_memberships'" class="reference internal" href="#toad.postprocessing.aggregation.precompute_spatial_memberships"><code class="docutils literal notranslate"><span class="pre">precompute_spatial_memberships()</span></code></a></li>
</ul>
</div>
</aside>
</main>
</div>
</div><footer class="py-6 border-t border-border md:py-0">
<div class="container flex flex-col items-center justify-between gap-4 md:h-24 md:flex-row">
<div class="flex flex-col items-center gap-4 px-8 md:flex-row md:gap-2 md:px-0">
<p class="text-sm leading-loose text-center text-muted-foreground md:text-left">© 2026, TOAD Developers Built with <a class="font-medium underline underline-offset-4" href="https://www.sphinx-doc.org" rel="noreferrer">Sphinx 9.1.0</a></p>
</div>
</div>
</footer>
</div>
<script src="../_static/documentation_options.js?v=5929fcd5"></script>
<script src="../_static/doctools.js?v=fd6eb6e6"></script>
<script src="../_static/sphinx_highlight.js?v=6ffebe34"></script>
<script defer="defer" src="../_static/theme.js?v=582b20c5"></script>
</body>
</html>